
<!DOCTYPE html>
<html lang="en">
<!--
   groupPage.html
   
   Copyright 2017 Bjorn <Bjorn@BERTHA>
   
-->

<!--
Planned JS insert area functionality:
1) construct rest of table if returns value
2) Use links if there's groups returned
3) offer create new group too.
-->
<head>
	<meta charset="utf-8" />
	<title>Find a Group</title>
	<meta name="groupSearch" content="Information" />
	<link rel="stylesheet" href="Style1.css" />
	
	<script type="text/javascript">

	var http = null;
	var shttp = null;
	function toGroupPage(group){
		var whereTo ="groupPage.html?"+group;
		alert(whereTo);
		window.location = whereTo;
	}
	//populates the mygroups window
	function fetchMyTeams(){
		
		http = new XMLHttpRequest();
		http.onreadystatechange = showTeams; //will need to debug before posting.
		http.open("GET", "http://localhost:3000/mygroups", true); //currently a-synchronous iirc
		http.send();
		//document.getElementById('myGroups').innerHTML = "<table><tr><td>'This could take a moment, please wait'</td></tr></table>";
	}
	function showTeams(){
		if (http.readyState==4) {
			var myArray = JSON.parse(http.responseText);
			console.log(myArray);
			var myTable = "<table class='tablePrint' id='groupList'>";
			for(var a=0; a<myArray.length;a++){
				console.log(myArray[a]);
				for(var key in myArray[a]){
					console.log(myArray[a][key]);
					myTable +="<tr class='collapsedRow'><td class='searchReturn'><a class='buttonInterior' href='groupPage?groupName="+myArray[a][key]+"'>"+myArray[a][key]+"</a></td></tr>";
				}
			}
			myTable+="</table>";
			document.getElementById('myGroups').innerHTML = myTable;
		}
	}
	//creates the table from theoretical data returned from the database
	function createTable(){
		//Just a catch in case they've not logged in. Probably going to be replaced with serverside redirects using passport's session storage.
		var bod = "game="+document.getElementById('Game').value+"&role="+document.getElementById('role').value+"&mode="+document.getElementById('mode').value;
		shttp = new XMLHttpRequest();
		shttp.onreadystatechange = populateTable; //will need to debug before posting.
		shttp.open("POST", "http://localhost:3000/myGroupSearch", true); //currently a-synchronous iirc
		shttp.send(bod);
		//document.getElementById('tablePrint').innerHTML = 'Processing';
		alert("sent");
		return false;
		
	}
	function populateTable(){
		if(shttp.readyState==4){
			var myArray = JSON.parse(shttp.responseText);
			var myTable= "";
			for(var b in myArray[0]){	
				if (myArray[0][b] == "No results found"){
					myTable = "<tr><td class='searchReturn'>"+myArray[0][b]+"</td></tr>";
				}
				else{
					for(var a=0; a<myArray.length; a++){
						for(var key in myArray[a]){
							myTable +="<tr><td class='searchReturn'>"+myArray[a][key]+"</td> <td class='searchReturn'><button type='button' onclick='toGroupPage("+'"groupName='+myArray[a][key]+'"'+");'>View Group</button></td></tr>";
						}
					}
				}
			document.getElementById('tablePrint').innerHTML = myTable;
			}
		}
	}
	//For if they don't log in
	function goLogin(){
		document.getElementById('myGroups').innerHTML = 'Login to see more!';
	}
	//on page load
	function toLoad(){
		fetchMyTeams();
		var time = new Date();
		document.getElementById('footTime').innerHTML = "It is now: " +time.getHours()+":"+time.getMinutes()+":"+time.getSeconds()+ "    Last updated on: 10/4/17" ;
		
		document.getElementById('logoutLink').innerHTML = 'Logout';
	}
	-->
	</script>
</head>
<body onload='toLoad();'>
	
	<div id="menu">
		<table id="quickLinks">
			<tr>
				<td><a class='header' href="Home">Home</a>  </td>
				<td><a class='header' href="groupSearch">MatchMaker</a>  </td>
				<td><a class='header' href="about">About us</a>	</td>	
				<td id="login">
					<table id="subtable">
						<tr> <td><a class="sign" href="login">login</a></td></tr>
						<tr> <td> <a class="sign" href="newUser" >sign up</a></td></tr> 
					</table>
				</td>
			</tr>
		</table>
	</div>

	<HR>
	<h1> Find a Team <br /> <br /></h1>
	

	<form id='MMS' name='myForm' method='post' > <!-- to the correct node spot -->
		<table id="MMsearch">

	<form id='MMS'> <!-- to the correct node spot -->
		<table id="MMsearch" class="formBox">

	<form id='MMS'> <!-- to the correct node spot -->
		<table id="MMsearch" class="formBox">

			<tr> 
				<td>
					<label for="Game">Game</label>
					<select id="Game" name="game">
						<option value="Dota2">DOTA 2</option>
						<option value="League">League of Legends</option>
						<option value="Heroes">Heroes of the Storm</option>
					</select>
					<label for="role"> Lane/Role</label>
					<select id="role" name="role">
						<option value=""> Fill/Any</option>
						<option value="Top"> Top</option>
						<option value="Mid"> Mid</option>
						<option value="Sup"> Support</option>
						<option value="ADC"> ADC</option>
						<option value="Jun"> Jungler</option>
					</select>
					<label for='mode'>Mode</label>
					<select name='mode' id='mode'>
						<option value=["Ranked", "Casual", "Both"]>Any</option>
						<option value=["Ranked"]>Ranked</option>
						<option value=["Casual"]>Casual</option>
						<option value=["Both"]>Both</option>
					</select>
					<!-- possible to refine down to character level, would have to have a search/term thing going down, 
					ugh... would look like a string with no strange characters, I suppose.-->
				</td>
			<tr>
				<td>
					<input class="submit" type="button" value="Get Started!" onclick='createTable();'>
				</td>
			</tr>
			<tr>
				<td>
					<table class='tablePrint' id="tablePrint"></table>
				</td>
			</tr><!---->
		</table>
		
	</form>
	<div>
		
	<div id='myGroups'></div>
		<!-- 
			Put in a table window of sorts. defined size, eventually with scroll option?
			populated by database query.
		-->
	
	</div>
	<footer>
		<div>
			<a href='Logout' id='logoutLink'></a>
			Written by <a href='mailto:mfitzay@gmail.com'> Matthew Fitzpatrick</a>.<br>
			Student number/Email: <a href='mailto:21297239@student.uwa.edu.au'>21297239</a>
			<p id='footTime'></p>
		</div>
	</footer>
</body>

</html>

